import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
from io import StringIO

# 1. ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬ í•¨ìˆ˜
@st.cache_data
def load_and_preprocess_data(file_content):
    """ì£¼ì–´ì§„ í…ìŠ¤íŠ¸ íŒŒì¼ ë‚´ìš©ì„ Pandas DataFrameìœ¼ë¡œ ë¡œë“œí•˜ê³  ì „ì²˜ë¦¬í•©ë‹ˆë‹¤."""
    # íƒ­(	)ìœ¼ë¡œ êµ¬ë¶„ëœ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , ì‹¤ì œ í—¤ë”ëŠ” 3ë²ˆì§¸ ì¤„(ì¸ë±ìŠ¤ 2)ì„ ì‚¬ìš©
    df = pd.read_csv(StringIO(file_content), sep='\t', header=2)
    
    # í•„ìš”í•œ ì—´ ì„ íƒ ë° ì´ë¦„ ë³€ê²½
    columns_map = {
        'ë™ë³„(2)': 'êµ¬',
        'ì†Œê³„': 'ì´ í™”ì¬ ê±´ìˆ˜',
        'ì „ê¸°ì ìš”ì¸': 'ì „ê¸°ì  ìš”ì¸',
        'ê¸°ê³„ì  ìš”ì¸': 'ê¸°ê³„ì  ìš”ì¸',
        'ê°€ìŠ¤ëˆ„ì¶œ(í­ë°œ)': 'ê°€ìŠ¤ ëˆ„ì¶œ(í­ë°œ)',
        'í™”í•™ì  ìš”ì¸': 'í™”í•™ì  ìš”ì¸',
        'êµí†µì‚¬ê³ ': 'êµí†µì‚¬ê³ ',
        'ë¶€ì£¼ì˜': 'ë¶€ì£¼ì˜',
        'ìì—°ì ì¸ ìš”ì¸': 'ìì—°ì ì¸ ìš”ì¸',
        'ë°©í™”ëª…í™•': 'ë°©í™” ëª…í™•',
        'ë°©í™”ì˜ì‹¬': 'ë°©í™” ì˜ì‹¬',
        'ë°œí™”ìš”ì¸(ê¸°íƒ€)': 'ê¸°íƒ€ ìš”ì¸',
        'ë°œí™”ìš”ì¸(ë¯¸ìƒ)': 'ë¯¸ìƒ ìš”ì¸'
    }
    df = df.rename(columns=columns_map)
    
    # êµ¬ë³„ ì†Œê³„ ë°ì´í„°ë§Œ ì¶”ì¶œ (ë™ë³„(3) ê°’ì´ 'ì†Œê³„'ì´ê³  êµ¬ ì´ë¦„ì´ 'ì†Œê³„'ê°€ ì•„ë‹Œ í–‰)
    df_borough = df[(df['ë™ë³„(3)'] == 'ì†Œê³„') & (df['êµ¬'] != 'ì†Œê³„')]
    
    # ë¶ˆí•„ìš”í•œ ì—´ ì œê±°
    df_borough = df_borough[['êµ¬'] + list(columns_map.values())[1:]]
    
    # ë°ì´í„° íƒ€ì… ë³€í™˜: '-'ë¥¼ 0ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì •ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
    for col in df_borough.columns[1:]:
        df_borough[col] = df_borough[col].replace('-', '0').astype(int)
        
    return df_borough

# 2. Streamlit ì•± êµ¬ì„±
def app():
    st.set_page_config(layout="wide")
    st.title("ğŸ”¥ ì„œìš¸ì‹œ 2007ë…„ êµ¬ë³„ í™”ì¬ ë°œìƒ í˜„í™©")
    st.caption("ë°ì´í„° ì¶œì²˜: seoul a.txt (2007ë…„ ë™ë³„ í™”ì¬ë°œìƒí˜„í™©)")

    # íŒŒì¼ ë‚´ìš© ë³€ìˆ˜: ì œê³µëœ 'seoul a.txt' íŒŒì¼ì˜ ì „ì²´ í…ìŠ¤íŠ¸ ë‚´ìš©
    file_content = """
ë™ë³„(1)	ë™ë³„(2)	ë™ë³„(3)	2007	2007	2007	2007	2007	2007	2007	2007	2007	2007	2007	2007
ë™ë³„(1)	ë™ë³„(2)	ë™ë³„(3)	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„	í•©ê³„
ë™ë³„(1)	ë™ë³„(2)	ë™ë³„(3)	ì†Œê³„	ì „ê¸°ì ìš”ì¸	ê¸°ê³„ì  ìš”ì¸	ê°€ìŠ¤ëˆ„ì¶œ(í­ë°œ)	í™”í•™ì  ìš”ì¸	êµí†µì‚¬ê³ 	ë¶€ì£¼ì˜	ìì—°ì ì¸ ìš”ì¸	ë°©í™”ëª…í™•	ë°©í™”ì˜ì‹¬	ë°œí™”ìš”ì¸(ê¸°íƒ€)	ë°œí™”ìš”ì¸(ë¯¸ìƒ)
í•©ê³„	ì†Œê³„	ì†Œê³„	6698	1682	291	32	18	47	3138	3	130	792	90	475
í•©ê³„	ì¢…ë¡œêµ¬	ì†Œê³„	189	56	9	1	-	1	67	-	6	28	2	19
í•©ê³„	ì¤‘êµ¬	ì†Œê³„	280	63	20	-	1	1	128	-	22	17	1	27
í•©ê³„	ì¤‘êµ¬	ì†Œê³µë™	11	3	-	-	-	-	8	-	-	-	-	-
í•©ê³„	ì¤‘êµ¬	íšŒí˜„ë™	28	5	1	-	-	-	12	-	1	4	1	4
í•©ê³„	ì¤‘êµ¬	ëª…ë™	37	8	3	-	-	-	19	-	4	3	-	-
í•©ê³„	ì¤‘êµ¬	í•„ë™	19	5	3	-	-	-	7	-	1	1	-	2
í•©ê³„	ì¤‘êµ¬	ì¥ì¶©ë™	15	2	2	-	-	1	7	-	1	-	-	2
í•©ê³„	ì¤‘êµ¬	ê´‘í¬ë™	32	8	3	-	1	-	15	-	1	2	-	2
í•©ê³„	ì¤‘êµ¬	ì„ì§€ë¡œë™	38	8	3	-	-	-	16	-	1	1	-	9
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹1ë™	26	10	2	-	-	-	10	-	1	2	-	1
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹2ë™	11	1	-	-	-	-	6	-	4	-	-	-
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹3ë™	10	5	-	-	-	-	4	-	1	-	-	-
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹4ë™	8	-	-	-	-	-	5	-	-	-	-	3
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹5ë™	10	4	-	-	-	-	5	-	1	-	-	-
í•©ê³„	ì¤‘êµ¬	ì‹ ë‹¹6ë™	7	-	2	-	-	-	4	-	1	-	-	-
í•©ê³„	ì¤‘êµ¬	í™©í•™ë™	15	2	-	-	-	-	3	-	4	4	-	2
í•©ê³„	ì¤‘êµ¬	ì¤‘ë¦¼ë™	13	2	1	-	-	-	7	-	1	-	-	2
í•©ê³„	ìš©ì‚°êµ¬	ì†Œê³„	224	48	12	-	-	2	93	-	-	47	4	18
í•©ê³„	ìš©ì‚°êµ¬	í›„ì•”ë™	5	1	-	-	-	-	-	-	-	-	-	-
í•©ê³„	ìš©ì‚°êµ¬	ìš©ì‚°2ê°€ë™	6	2	-	-	-	-	-	-	-	1	-	-
í•©ê³„	ìš©ì‚°êµ¬	ë‚¨ì˜ë™	25	5	-	-	-	-	-	-	-	7	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì²­íŒŒ1ë™	20	3	-	-	-	-	-	-	-	8	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì²­íŒŒ2ë™	6	2	-	-	-	-	-	-	-	2	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì›íš¨ë¡œ1ë™	9	2	-	-	-	-	-	-	-	2	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì›íš¨ë¡œ2ë™	15	1	-	-	-	1	-	-	-	4	-	-
í•©ê³„	ìš©ì‚°êµ¬	íš¨ì°½ë™	19	2	-	-	-	-	-	-	-	3	-	-
í•©ê³„	ìš©ì‚°êµ¬	ìš©ë¬¸ë™	6	-	-	-	-	-	-	-	-	4	-	-
í•©ê³„	ìš©ì‚°êµ¬	í•œê°•ë¡œ1ë™	11	2	-	-	-	-	-	-	-	1	-	-
í•©ê³„	ìš©ì‚°êµ¬	í•œê°•ë¡œ2ë™	13	4	-	-	-	1	-	-	-	1	-	-
í•©ê³„	ìš©ì‚°êµ¬	í•œê°•ë¡œ3ë™	9	2	-	-	-	-	-	-	-	2	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì´ì´Œ1ë™	9	3	-	-	-	-	-	-	-	-	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì´ì´Œ2ë™	5	-	-	-	-	-	-	-	-	1	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì´íƒœì›1ë™	11	2	-	-	-	-	-	-	-	-	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì´íƒœì›2ë™	17	7	-	-	-	-	-	-	-	7	-	-
í•©ê³„	ìš©ì‚°êµ¬	í•œë‚¨1ë™	10	5	-	-	-	-	-	-	-	-	-	-
í•©ê³„	ìš©ì‚°êµ¬	í•œë‚¨2ë™	15	4	-	-	-	-	-	-	-	2	-	-
í•©ê³„	ìš©ì‚°êµ¬	ì„œë¹™ê³ ë™	9	-	-	-	-	-	-	-	-	1	-	-
í•©ê³„	ìš©ì‚°êµ¬	ë³´ê´‘ë™	4	1	-	-	-	-	-	-	-	1	-	-
í•©ê³„	ì„±ë™êµ¬	ì†Œê³„	230	62	16	2	3	5	101	-	5	24	-	12
í•©ê³„	ê´‘ì§„êµ¬	ì†Œê³„	265	67	10	-	-	1	128	-	5	43	1	10
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì†Œê³„	374	82	9	3	1	2	180	-	6	69	-	22
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì‹ ì„¤ë™	7	2	-	-	-	-	3	-	-	1	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ìš©ë‘1ë™	24	3	-	-	-	1	11	-	-	8	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ìš©ë‘2ë™	26	6	1	-	-	1	11	-	2	4	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì œê¸°1ë™	19	8	-	-	-	-	5	-	-	6	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì œê¸°2ë™	18	2	-	-	-	-	6	-	-	4	-	6
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì „ë†1ë™	7	1	-	-	-	-	6	-	-	-	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì „ë†2ë™	13	1	1	-	-	-	8	-	-	1	-	2
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì „ë†3ë™	14	2	1	2	-	-	7	-	-	1	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì „ë†4ë™	12	1	1	-	-	-	10	-	-	-	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ë‹µì‹­ë¦¬1ë™	14	5	1	-	-	-	4	-	-	4	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ë‹µì‹­ë¦¬2ë™	13	-	-	-	-	-	2	-	-	10	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ë‹µì‹­ë¦¬3ë™	7	1	-	-	-	-	4	-	-	1	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ë‹µì‹­ë¦¬4ë™	11	4	-	-	-	-	7	-	-	-	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ë‹µì‹­ë¦¬5ë™	10	1	-	-	-	-	5	-	-	3	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì¥ì•ˆ1ë™	17	4	1	-	-	-	8	-	1	1	-	2
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì¥ì•ˆ2ë™	19	5	-	-	-	-	9	-	-	5	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì¥ì•ˆ3ë™	21	7	-	1	-	-	8	-	1	3	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì¥ì•ˆ4ë™	16	3	-	-	1	-	10	-	-	1	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì²­ëŸ‰ë¦¬1ë™	14	2	1	-	-	-	7	-	-	4	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì²­ëŸ‰ë¦¬2ë™	9	1	-	-	-	-	4	-	2	2	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	íšŒê¸°ë™	17	9	-	-	-	-	6	-	-	2	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	íœ˜ê²½1ë™	19	2	-	-	-	-	15	-	-	2	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	íœ˜ê²½2ë™	19	8	1	-	-	-	8	-	-	2	-	-
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì´ë¬¸1ë™	7	1	1	-	-	-	4	-	-	-	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì´ë¬¸2ë™	12	3	-	-	-	-	6	-	-	2	-	1
í•©ê³„	ë™ëŒ€ë¬¸êµ¬	ì´ë¬¸3ë™	9	-	-	-	-	-	6	-	-	2	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ì†Œê³„	256	54	16	2	1	1	141	-	2	29	-	10
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©2ë™	23	6	3	1	-	-	9	-	-	3	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©4ë™	15	4	-	-	-	-	9	-	-	2	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©5ë™	7	3	-	-	-	-	3	-	-	-	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©7ë™	17	8	3	-	-	-	4	-	-	1	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ìƒë´‰1ë™	9	-	-	-	-	-	8	-	-	1	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ìƒë´‰2ë™	19	3	1	-	-	-	11	-	1	2	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ì¤‘í™”1ë™	8	2	1	-	-	-	5	-	-	-	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ì¤‘í™”2ë™	23	4	1	-	-	-	15	-	-	2	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ë¬µ1ë™	12	4	1	-	-	-	4	-	-	2	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ë¬µ2ë™	12	2	-	-	-	-	8	-	-	-	-	2
í•©ê³„	ì¤‘ë‘êµ¬	ë§ìš°3ë™	13	-	1	-	1	1	8	-	-	2	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ì‹ ë‚´1ë™	14	1	2	1	-	-	6	-	-	3	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ì‹ ë‚´2ë™	15	1	-	-	-	-	13	-	1	-	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©ë³¸ë™	28	8	1	-	-	-	14	-	-	4	-	1
í•©ê³„	ì¤‘ë‘êµ¬	ë©´ëª©3.8ë™	13	2	1	-	-	-	8	-	-	2	-	-
í•©ê³„	ì¤‘ë‘êµ¬	ë§ìš°ë³¸ë™	28	6	1	-	-	-	16	-	-	5	-	-
í•©ê³„	ì„±ë¶êµ¬	ì†Œê³„	304	71	14	1	1	-	169	-	6	31	-	11
í•©ê³„	ê°•ë¶êµ¬	ì†Œê³„	174	43	5	1	2	-	66	-	8	22	4	23
í•©ê³„	ë„ë´‰êµ¬	ì†Œê³„	192	69	13	1	1	2	71	-	3	17	2	13
í•©ê³„	ë…¸ì›êµ¬	ì†Œê³„	296	66	11	3	-	3	133	1	6	36	1	36
í•©ê³„	ë…¸ì›êµ¬	ì›”ê³„1ë™	17	2	1	-	-	-	9	-	-	3	-	2
í•©ê³„	ë…¸ì›êµ¬	ì›”ê³„2ë™	11	-	-	-	-	-	8	-	-	3	-	-
í•©ê³„	ë…¸ì›êµ¬	ì›”ê³„3ë™	13	2	-	-	-	-	5	-	1	3	-	2
í•©ê³„	ë…¸ì›êµ¬	ì›”ê³„4ë™	8	1	-	1	-	-	3	-	1	1	-	1
í•©ê³„	ë…¸ì›êµ¬	ê³µë¦‰2ë™	22	6	-	1	-	-	11	-	1	1	1	1
í•©ê³„	ë…¸ì›êµ¬	í•˜ê³„1ë™	17	7	1	-	-	-	5	-	-	1	-	3
í•©ê³„	ë…¸ì›êµ¬	í•˜ê³„2ë™	8	1	-	-	-	2	2	-	-	2	-	1
í•©ê³„	ë…¸ì›êµ¬	ì¤‘ê³„ë³¸ë™	22	7	1	-	-	-	11	-	-	2	-	1
í•©ê³„	ë…¸ì›êµ¬	ì¤‘ê³„1ë™	6	-	-	-	-	-	5	-	-	1	-	-
í•©ê³„	ë…¸ì›êµ¬	ì¤‘ê³„2ë™	9	2	-	-	-	-	5	-	1	1	-	-
í•©ê³„	ë…¸ì›êµ¬	ì¤‘ê³„3ë™	12	3	-	-	-	-	8	-	-	-	-	1
í•©ê³„	ë…¸ì›êµ¬	ì¤‘ê³„4ë™	9	2	-	-	-	-	6	-	-	1	-	-
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„1ë™	15	3	1	-	-	1	5	-	-	2	-	3
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„2ë™	23	8	1	-	-	-	9	-	-	3	-	2
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„5ë™	16	1	1	-	-	-	6	1	-	4	-	3
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„8ë™	5	1	2	-	-	-	1	-	-	-	-	1
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„9ë™	3	-	-	-	-	-	2	-	-	1	-	-
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„10ë™	7	2	2	-	-	-	2	-	-	-	-	1
í•©ê³„	ë…¸ì›êµ¬	ê³µë¦‰1.3ë™	21	8	-	-	-	-	7	-	-	-	-	6
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„3.4ë™	32	6	-	-	-	-	13	-	2	3	-	8
í•©ê³„	ë…¸ì›êµ¬	ìƒê³„6.7ë™	20	4	1	1	-	-	10	-	-	4	-	-
í•©ê³„	ì€í‰êµ¬	ì†Œê³„	288	72	7	2	1	1	151	-	3	38	3	10
í•©ê³„	ì€í‰êµ¬	ë…¹ë²ˆë™	24	2	3	-	-	-	13	-	-	4	-	2
í•©ê³„	ì€í‰êµ¬	ë¶ˆê´‘1ë™	9	4	-	-	-	-	5	-	-	-	-	-
í•©ê³„	ì€í‰êµ¬	ë¶ˆê´‘2ë™	14	2	-	-	-	-	11	-	-	1	-	-
í•©ê³„	ì€í‰êµ¬	ë¶ˆê´‘3ë™	3	-	-	-	-	-	2	-	-	-	-	1
í•©ê³„	ì€í‰êµ¬	ê°ˆí˜„1ë™	21	7	1	-	-	-	8	-	-	3	-	2
í•©ê³„	ì€í‰êµ¬	ê°ˆí˜„2ë™	31	11	-	-	-	-	14	-	1	3	-	2
í•©ê³„	ì€í‰êµ¬	êµ¬ì‚°ë™	15	4	-	-	1	-	7	-	1	1	-	1
í•©ê³„	ì€í‰êµ¬	ëŒ€ì¡°ë™	13	3	1	-	-	-	3	-	-	5	1	-
í•©ê³„	ì€í‰êµ¬	ì‘ì•”1ë™	18	5	-	-	-	-	11	-	-	1	1	-
í•©ê³„	ì€í‰êµ¬	ì‘ì•”2ë™	10	3	-	-	-	-	4	-	-	2	-	1
í•©ê³„	ì€í‰êµ¬	ì‘ì•”3ë™	8	-	-	1	-	-	4	-	-	3	-	-
í•©ê³„	ì€í‰êµ¬	ì‘ì•”4ë™	12	3	-	-	-	-	7	-	-	2	-	-
í•©ê³„	ì€í‰êµ¬	ì—­ì´Œ1ë™	16	3	-	-	-	-	7	-	-	4	1	1
í•©ê³„	ì€í‰êµ¬	ì—­ì´Œ2ë™	11	3	-	-	-	-	4	-	1	3	-	-
í•©ê³„	ì€í‰êµ¬	ì‹ ì‚¬1ë™	21	3	-	-	-	-	17	-	-	1	-	-
í•©ê³„	ì€í‰êµ¬	ì‹ ì‚¬2ë™	7	2	-	-	-	-	4	-	-	1	-	-
í•©ê³„	ì€í‰êµ¬	ì¦ì‚°ë™	13	3	1	-	-	1	7	-	-	1	-	-
í•©ê³„	ì€í‰êµ¬	ìˆ˜ìƒ‰ë™	24	9	1	1	-	-	12	-	-	1	-	-
í•©ê³„	ì€í‰êµ¬	ì§„ê´€ë™	18	5	-	-	-	-	11	-	-	2	-	-
í•©ê³„	ì„œëŒ€ë¬¸êµ¬	ì†Œê³„	297	86	1	2	-	-	173	-	-	26	4	5
í•©ê³„	ë§ˆí¬êµ¬	ì†Œê³„	324	62	13	2	-	3	147	-	1	73	-	23
í•©ê³„	ì–‘ì²œêµ¬	ì†Œê³„	225	46	-	2	-	-	68	-	22	-	61	26
í•©ê³„	ì–‘ì²œêµ¬	ëª©1ë™	18	4	-	-	-	-	3	-	-	-	8	3
í•©ê³„	ì–‘ì²œêµ¬	ëª©2ë™	18	2	-	-	-	-	6	-	1	-	7	2
í•©ê³„	ì–‘ì²œêµ¬	ëª©3ë™	5	3	-	-	-	-	2	-	-	-	-	-
í•©ê³„	ì–‘ì²œêµ¬	ëª©4ë™	8	2	-	-	-	-	4	-	-	-	-	2
í•©ê³„	ì–‘ì²œêµ¬	ëª©5ë™	1	1	-	-	-	-	-	-	-	-	-	-
í•©ê³„	ì–‘ì²œêµ¬	ëª©6ë™	2	1	-	-	-	-	1	-	-	-	-	-
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”1ë™	23	6	-	1	-	-	8	-	3	-	4	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”2ë™	12	1	-	-	-	-	4	-	1	-	6	-
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”3ë™	10	3	-	-	-	-	2	-	1	-	2	2
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”4ë™	9	2	-	-	-	-	2	-	-	-	3	2
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”5ë™	8	1	-	-	-	-	3	-	3	-	1	-
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”6ë™	8	-	-	-	-	-	4	-	2	-	1	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì›”7ë™	9	1	-	-	-	-	4	-	-	-	3	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •1ë™	13	4	-	1	-	-	3	-	1	-	3	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •2ë™	9	2	-	-	-	-	2	-	-	-	4	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •3ë™	13	1	-	-	-	-	3	-	-	-	8	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •4ë™	9	3	-	-	-	-	2	-	-	-	2	2
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •5ë™	20	4	-	-	-	-	6	-	5	-	1	4
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •6ë™	16	2	-	-	-	-	5	-	2	-	6	1
í•©ê³„	ì–‘ì²œêµ¬	ì‹ ì •7ë™	14	3	-	-	-	-	4	-	3	-	2	2
í•©ê³„	ê°•ì„œêµ¬	ì†Œê³„	381	84	13	1	-	-	230	-	4	29	1	19
í•©ê³„	ê°•ì„œêµ¬	ì—¼ì°½ë™	29	4	4	-	-	-	17	-	-	3	-	1
í•©ê³„	ê°•ì„œêµ¬	ë“±ì´Œ1ë™	19	1	1	-	-	-	14	-	-	2	-	1
í•©ê³„	ê°•ì„œêµ¬	ë“±ì´Œ2ë™	9	-	-	-	-	-	8	-	-	1	-	-
í•©ê³„	ê°•ì„œêµ¬	ë“±ì´Œ3ë™	33	8	-	-	-	-	21	-	2	2	-	-
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡ë³¸ë™	32	5	-	-	-	-	23	-	-	3	-	1
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡1ë™	24	6	-	-	-	-	15	-	1	2	-	-
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡2ë™	10	2	-	-	-	-	7	-	-	1	-	-
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡3ë™	14	3	-	-	-	-	9	-	-	1	-	1
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡4ë™	18	5	-	-	-	-	10	-	-	2	1	-
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡5ë™	17	6	-	-	-	-	11	-	-	-	-	-
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡6ë™	21	10	-	-	-	-	9	-	-	1	-	1
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡7ë™	14	2	-	-	-	-	11	-	-	-	-	1
í•©ê³„	ê°•ì„œêµ¬	í™”ê³¡8ë™	13	3	-	-	-	-	7	-	-	2	-	1
í•©ê³„	ê°•ì„œêµ¬	ê°€ì–‘1ë™	12	1	2	-	-	-	5	-	1	-	-	3
í•©ê³„	ê°•ì„œêµ¬	ê°€ì–‘2ë™	15	3	-	-	-	-	9	-	-	2	-	1
í•©ê³„	ê°•ì„œêµ¬	ê°€ì–‘3ë™	9	1	-	-	-	-	6	-	-	-	-	2
í•©ê³„	ê°•ì„œêµ¬	ë°œì‚°1ë™	18	5	1	1	-	-	10	-	-	1	-	-
í•©ê³„	ê°•ì„œêµ¬	ë°œì‚°2ë™	7	1	-	-	-	-	5	-	-	-	-	1
í•©ê³„	ê°•ì„œêµ¬	ê³µí•­ë™	19	5	-	-	-	-	11	-	-	1	-	2
í•©ê³„	ê°•ì„œêµ¬	ë°©í™”1ë™	20	6	1	-	-	-	8	-	-	3	-	2
í•©ê³„	ê°•ì„œêµ¬	ë°©í™”2ë™	17	7	2	-	-	-	6	-	-	1	-	1
í•©ê³„	ê°•ì„œêµ¬	ë°©í™”3ë™	11	-	2	-	-	-	8	-	-	1	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ì†Œê³„	171	56	17	-	1	-	55	-	4	17	2	19
í•©ê³„	êµ¬ë¡œêµ¬	ì‹ ë„ë¦¼ë™	11	3	3	-	1	-	1	-	-	2	-	1
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ1ë™	7	-	2	-	-	-	5	-	-	-	-	-
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ2ë™	11	3	-	-	-	-	5	-	1	1	-	1
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ3ë™	14	4	2	-	-	-	5	-	1	-	1	1
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ4ë™	5	2	-	-	-	-	3	-	-	-	-	-
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ5ë™	14	4	2	-	-	-	5	-	-	2	-	1
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œ6ë™	4	2	-	-	-	-	2	-	-	-	-	-
í•©ê³„	êµ¬ë¡œêµ¬	êµ¬ë¡œë³¸ë™	10	5	2	-	-	-	1	-	1	-	-	1
í•©ê³„	êµ¬ë¡œêµ¬	ê°€ë¦¬ë´‰1ë™	11	5	-	-	-	-	4	-	-	1	-	1
í•©ê³„	êµ¬ë¡œêµ¬	ê°€ë¦¬ë´‰2ë™	2	-	-	-	-	-	-	-	-	2	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ê³ ì²™1ë™	15	5	2	-	-	-	3	-	1	-	-	4
í•©ê³„	êµ¬ë¡œêµ¬	ê³ ì²™2ë™	13	5	-	-	-	-	7	-	-	1	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ê°œë´‰1ë™	4	2	1	-	-	-	1	-	-	-	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ê°œë´‰2ë™	4	3	-	-	-	-	-	-	-	1	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ê°œë´‰3ë™	5	-	-	-	-	-	2	-	-	2	-	1
í•©ê³„	êµ¬ë¡œêµ¬	ê°œë´‰ë³¸ë™	9	4	1	-	-	-	2	-	-	-	1	1
í•©ê³„	êµ¬ë¡œêµ¬	ì˜¤ë¥˜1ë™	6	4	-	-	-	-	2	-	-	-	-	-
í•©ê³„	êµ¬ë¡œêµ¬	ì˜¤ë¥˜2ë™	15	3	-	-	-	-	2	-	-	4	-	6
í•©ê³„	êµ¬ë¡œêµ¬	ìˆ˜ê¶ë™	11	2	2	-	-	-	5	-	-	1	-	1
í•©ê³„	ê¸ˆì²œêµ¬	ì†Œê³„	113	36	14	-	-	-	33	-	1	8	-	21
í•©ê³„	ê¸ˆì²œêµ¬	ê°€ì‚°ë™	22	9	3	-	-	-	7	-	-	1	-	2
í•©ê³„	ê¸ˆì²œêµ¬	ë…ì‚°1ë™	23	3	6	-	-	-	3	-	1	1	-	9
í•©ê³„	ê¸ˆì²œêµ¬	ë…ì‚°2ë™	4	-	2	-	-	-	2	-	-	-	-	-
í•©ê³„	ê¸ˆì²œêµ¬	ë…ì‚°3ë™	10	5	-	-	-	-	3	-	-	1	-	1
í•©ê³„	ê¸ˆì²œêµ¬	ë…ì‚°4ë™	6	3	1	-	-	-	1	-	-	1	-	-
í•©ê³„	ê¸ˆì²œêµ¬	ì‹œí¥1ë™	30	9	1	-	-	-	11	-	-	2	-	7
í•©ê³„	ê¸ˆì²œêµ¬	ì‹œí¥2ë™	2	1	-	-	-	-	1	-	-	-	-	-
í•©ê³„	ê¸ˆì²œêµ¬	ì‹œí¥3ë™	6	1	-	-	-	-	4	-	-	-	-	1
í•©ê³„	ê¸ˆì²œêµ¬	ì‹œí¥4ë™	7	4	1	-	-	-	-	-	-	2	-	-
í•©ê³„	ê¸ˆì²œêµ¬	ì‹œí¥5ë™	3	1	-	-	-	-	1	-	-	-	-	1
í•©ê³„	ì˜ë“±í¬êµ¬	ì†Œê³„	322	83	21	1	1	1	174	-	-	31	1	9
í•©ê³„	ì˜ë“±í¬êµ¬	ì˜ë“±í¬1ë™	13	2	-	-	-	-	8	-	-	2	-	1
í•©ê³„	ì˜ë“±í¬êµ¬	ì˜ë“±í¬2ë™	23	8	1	-	-	-	11	-	-	3	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì˜ë“±í¬3ë™	12	3	-	1	-	-	5	-	-	3	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì—¬ì˜ë™	24	10	3	-	-	-	9	-	-	-	-	2
í•©ê³„	ì˜ë“±í¬êµ¬	ë‹¹ì‚°1ë™	21	8	5	-	-	-	5	-	-	2	-	1
í•©ê³„	ì˜ë“±í¬êµ¬	ë‹¹ì‚°2ë™	17	1	2	-	-	-	14	-	-	-	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ë„ë¦¼1ë™	10	-	-	-	-	-	8	-	-	2	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ë„ë¦¼2ë™	9	3	-	-	-	-	5	-	-	1	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ë¬¸ë˜1ë™	23	6	4	-	-	-	13	-	-	-	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ë¬¸ë˜2ë™	6	-	1	-	-	-	4	-	-	-	-	1
í•©ê³„	ì˜ë“±í¬êµ¬	ì–‘í‰1ë™	15	6	-	-	-	-	7	-	-	2	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì–‘í‰2ë™	13	4	1	-	1	1	4	-	-	1	-	1
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸1ë™	22	6	1	-	-	-	10	-	-	3	1	1
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸2ë™	10	5	-	-	-	-	5	-	-	-	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸3ë™	18	5	-	-	-	-	12	-	-	1	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸4ë™	9	2	1	-	-	-	5	-	-	1	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸5ë™	16	4	-	-	-	-	8	-	-	4	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸6ë™	12	1	1	-	-	-	6	-	-	2	-	2
í•©ê³„	ì˜ë“±í¬êµ¬	ì‹ ê¸¸7ë™	2	-	-	-	-	-	2	-	-	-	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ëŒ€ë¦¼1ë™	13	4	-	-	-	-	8	-	-	1	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ëŒ€ë¦¼2ë™	17	4	-	-	-	-	11	-	-	2	-	-
í•©ê³„	ì˜ë“±í¬êµ¬	ëŒ€ë¦¼3ë™	17	1	1	-	-	-	14	-	-	1	-	-
í•©ê³„	ë™ì‘êµ¬	ì†Œê³„	229	56	3	2	1	4	117	-	4	30	2	10
í•©ê³„	ë™ì‘êµ¬	ë…¸ëŸ‰ì§„1ë™	21	3	1	-	-	-	16	-	-	-	-	1
í•©ê³„	ë™ì‘êµ¬	ë…¸ëŸ‰ì§„2ë™	15	2	-	1	-	1	8	-	-	1	-	2
í•©ê³„	ë™ì‘êµ¬	ìƒë„1ë™	10	1	-	-	-	-	7	-	-	2	-	-
í•©ê³„	ë™ì‘êµ¬	ìƒë„2ë™	15	5	-	-	-	-	8	-	-	2	-	-
í•©ê³„	ë™ì‘êµ¬	ìƒë„3ë™	12	2	-	1	1	-	7	-	-	1	-	-
í•©ê³„	ë™ì‘êµ¬	ìƒë„4ë™	9	1	-	-	-	-	8	-	-	-	-	-
í•©ê³„	ë™ì‘êµ¬	ìƒë„5ë™	9	2	-	-	-	-	4	-	-	3	-	-
í•©ê³„	ë™ì‘êµ¬	ë³¸ë™	9	2	-	-	-	1	2	-	-	3	-	1
í•©ê³„	ë™ì‘êµ¬	í‘ì„1ë™	5	2	-	-	-	-	1	-	-	2	-	-
í•©ê³„	ë™ì‘êµ¬	í‘ì„2ë™	11	3	-	-	-	-	4	-	-	2	1	1
í•©ê³„	ë™ì‘êµ¬	í‘ì„3ë™	5	3	-	-	-	-	1	-	1	-	-	-
í•©ê³„	ë™ì‘êµ¬	ë™ì‘ë™	7	3	-	-	-	2	1	-	-	1	-	-
í•©ê³„	ë™ì‘êµ¬	ì‚¬ë‹¹1ë™	20	6	-	-	-	-	11	-	-	2	1	-
í•©ê³„	ë™ì‘êµ¬	ì‚¬ë‹¹2ë™	9	3	-	-	-	-	2	-	-	1	-	3
í•©ê³„	ë™ì‘êµ¬	ì‚¬ë‹¹3ë™	10	2	1	-	-	-	5	-	-	2	-	-
í•©ê³„	ë™ì‘êµ¬	ì‚¬ë‹¹4ë™	6	2	-	-	-	-	2	-	2	-	-	-
í•©ê³„	ë™ì‘êµ¬	ì‚¬ë‹¹5ë™	6	2	-	-	-	-	4	-	-	-	-	-
í•©ê³„	ë™ì‘êµ¬	ëŒ€ë°©ë™	24	7	1	-	-	-	9	-	-	5	-	2
í•©ê³„	ë™ì‘êµ¬	ì‹ ëŒ€ë°©1ë™	12	1	-	-	-	-	9	-	1	1	-	-
í•©ê³„	ë™ì‘êµ¬	ì‹ ëŒ€ë°©2ë™	14	4	-	-	-	-	8	-	-	2	-	-
í•©ê³„	ê´€ì•…êµ¬	ì†Œê³„	257	57	8	-	-	1	114	1	3	46	-	27
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œë³¸ë™	17	6	1	-	-	1	7	-	-	-	-	2
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ1ë™	7	1	-	-	-	-	2	-	-	4	-	-
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ3ë™	3	1	-	-	-	-	2	-	-	-	-	-
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ5ë™	10	2	-	-	-	-	3	-	1	-	-	4
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ6ë™	10	3	-	-	-	-	4	-	-	3	-	-
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ7ë™	22	5	2	-	-	-	9	-	-	4	-	2
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ8ë™	14	1	1	-	-	-	8	-	1	2	-	1
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ10ë™	16	5	1	-	-	-	9	-	-	1	-	-
í•©ê³„	ê´€ì•…êµ¬	ë´‰ì²œ11ë™	7	2	1	-	-	-	1	-	-	1	-	2
í•©ê³„	ê´€ì•…êµ¬	ë‚¨í˜„ë™	13	3	1	-	-	-	7	1	-	-	-	1
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼ë³¸ë™	12	6	-	-	-	-	3	-	-	3	-	-
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼1ë™	7	1	-	-	-	-	3	-	-	2	-	1
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼2ë™	7	1	-	-	-	-	3	-	-	3	-	-
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼3ë™	10	1	-	-	-	-	4	-	-	2	-	3
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼4ë™	13	2	-	-	-	-	7	-	-	2	-	2
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼5ë™	27	7	1	-	-	-	13	-	1	2	-	3
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼7ë™	9	1	-	-	-	-	5	-	-	1	-	2
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼8ë™	10	4	-	-	-	-	2	-	-	3	-	1
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼9ë™	24	3	-	-	-	-	10	-	-	8	-	3
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼10ë™	7	1	-	-	-	-	5	-	-	1	-	-
í•©ê³„	ê´€ì•…êµ¬	ì‹ ë¦¼12ë™	12	1	-	-	-	-	7	-	-	4	-	-
í•©ê³„	ì„œì´ˆêµ¬	ì†Œê³„	363	97	25	-	2	9	157	-	3	31	1	38
í•©ê³„	ê°•ë‚¨êµ¬	ì†Œê³„	265	89	10	2	-	6	106	-	9	18	-	25
í•©ê³„	ì†¡íŒŒêµ¬	ì†Œê³„	446	111	19	3	2	3	239	1	2	56	-	10
í•©ê³„	ê°•ë™êµ¬	ì†Œê³„	233	66	5	1	-	1	97	-	5	26	-	32
"""
    
    try:
        df_borough = load_and_preprocess_data(file_content)
    except Exception as e:
        st.error(f"ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        return

    st.header("1. êµ¬ë³„ í™”ì¬ ë°œìƒ ê±´ìˆ˜ ìˆœìœ„")

    # 1. ì´ í™”ì¬ ê±´ìˆ˜ ìˆœìœ„
    df_sorted = df_borough.sort_values(by='ì´ í™”ì¬ ê±´ìˆ˜', ascending=False)
    
    col1, col2 = st.columns([1, 2])
    
    with col1:
        st.subheader("ì´ í™”ì¬ ê±´ìˆ˜ Top 5")
        top_5_data = df_sorted[['êµ¬', 'ì´ í™”ì¬ ê±´ìˆ˜']].head(5).reset_index(drop=True)
        st.dataframe(top_5_data, use_container_width=True)
        
        # ì´ í™”ì¬ ê±´ìˆ˜ ì •ë³´
        st.markdown(f"* **ìµœë‹¤ ë°œìƒ êµ¬:** **{df_sorted.iloc[0]['êµ¬']}** ({df_sorted.iloc[0]['ì´ í™”ì¬ ê±´ìˆ˜']}ê±´)")
        st.markdown(f"* **ìµœì†Œ ë°œìƒ êµ¬:** **{df_sorted.iloc[-1]['êµ¬']}** ({df_sorted.iloc[-1]['ì´ í™”ì¬ ê±´ìˆ˜']}ê±´)")

        # ì „ì²´ ì„œìš¸ì‹œ í™”ì¬ í˜„í™© ë¡œì§ ìˆ˜ì •
        # 1. header=2ë¡œ ì›ë³¸ ë°ì´í„° ë¡œë“œ
        df_raw = pd.read_csv(StringIO(file_content), sep='\t', header=2)
        # 2. ì „ì²´ í•©ê³„ í–‰ì€ iloc[0]ì— ìœ„ì¹˜í•¨
        df_total = df_raw.iloc[0]
        
        # 3. ê³„ì‚°ì„ ìœ„í•´ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜ (TypeError ë°©ì§€)
        total_so_gye = pd.to_numeric(df_total['ì†Œê³„'], errors='coerce')
        total_bu_ju_eui = pd.to_numeric(df_total['ë¶€ì£¼ì˜'], errors='coerce')
        
        # 4. ë¹„ìœ¨ ê³„ì‚° (NaN ê°’ ì²˜ë¦¬ í¬í•¨)
        if total_so_gye > 0:
            percentage = (total_bu_ju_eui / total_so_gye * 100)
        else:
            percentage = 0.0

        st.markdown(f"**ì„œìš¸ì‹œ ì „ì²´ ì´ í™”ì¬ ê±´ìˆ˜:** **{int(total_so_gye)}ê±´**")
        # ìˆ˜ì •ëœ ê³„ì‚°ì„ ì‚¬ìš©
        st.markdown(f"**ì„œìš¸ì‹œ ì „ì²´ ë¶€ì£¼ì˜ í™”ì¬:** **{int(total_bu_ju_eui)}ê±´** (ì•½ {percentage:.2f}%)")

    
    with col2:
        fig_total = px.bar(
            df_sorted,
            x='êµ¬',
            y='ì´ í™”ì¬ ê±´ìˆ˜',
            title='êµ¬ë³„ ì´ í™”ì¬ ê±´ìˆ˜ (2007)',
            color='ì´ í™”ì¬ ê±´ìˆ˜',
            color_continuous_scale=px.colors.sequential.Reds
        )
        st.plotly_chart(fig_total, use_container_width=True)

    st.header("2. ë°œí™” ìš”ì¸ë³„ ë¶„ì„")
    st.markdown("íŠ¹ì • ë°œí™” ìš”ì¸ì„ ì„ íƒí•˜ì—¬ êµ¬ë³„ ë°œìƒ í˜„í™©ì„ ë¹„êµí•˜ê³ , í•´ë‹¹ ìš”ì¸ì´ ì´ í™”ì¬ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨ì„ í™•ì¸í•©ë‹ˆë‹¤.")

    # 2. ë°œí™” ìš”ì¸ë³„ ë¹„êµ
    cause_columns = df_borough.columns[2:].tolist()
    selected_cause = st.selectbox("ë¶„ì„í•  ë°œí™” ìš”ì¸ì„ ì„ íƒí•˜ì„¸ìš”:", cause_columns)

    df_cause_sorted = df_borough.sort_values(by=selected_cause, ascending=False)
    
    # ë¹„ìœ¨ ê³„ì‚° ë° ì¶”ê°€
    # 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ replace([np.inf, -np.inf], np.nan).fillna(0) ì ìš©
    df_cause_sorted['ë¹„ìœ¨ (%)'] = (df_cause_sorted[selected_cause] / df_cause_sorted['ì´ í™”ì¬ ê±´ìˆ˜'] * 100).replace([np.inf, -np.inf], np.nan).fillna(0).round(2)
    
    col3, col4 = st.columns([1, 2])
    
    with col3:
        st.subheader(f"'{selected_cause}' ë°œìƒ ìˆœìœ„ Top 5")
        st.dataframe(df_cause_sorted[['êµ¬', selected_cause, 'ë¹„ìœ¨ (%)']].head(5).reset_index(drop=True), use_container_width=True)
        
        # ì „ì²´ í•©ê³„ ê³„ì‚°
        total_in_selected_cause = df_borough[selected_cause].sum()
        st.markdown(f"**ì„œìš¸ì‹œ ì „ì²´ '{selected_cause}' ë°œìƒ:** **{total_in_selected_cause}ê±´**")
        
        # ë¹„ìœ¨ì´ ë†’ì€ êµ¬ Top 3
        st.subheader(f"'{selected_cause}' ë¹„ìœ¨ Top 3")
        df_ratio_sorted = df_cause_sorted.sort_values(by='ë¹„ìœ¨ (%)', ascending=False)
        st.dataframe(df_ratio_sorted[['êµ¬', 'ë¹„ìœ¨ (%)']].head(3).reset_index(drop=True), use_container_width=True)

    
    with col4:
        # ë°œìƒ ê±´ìˆ˜ ì‹œê°í™”
        fig_cause_count = px.bar(
            df_cause_sorted,
            x='êµ¬',
            y=selected_cause,
            title=f"êµ¬ë³„ '{selected_cause}' ë°œìƒ ê±´ìˆ˜",
            color=selected_cause,
            color_continuous_scale=px.colors.sequential.Plasma
        )
        st.plotly_chart(fig_cause_count, use_container_width=True)
        
        # ë¹„ìœ¨ ì‹œê°í™”
        fig_cause_ratio = px.bar(
            df_ratio_sorted,
            x='êµ¬',
            y='ë¹„ìœ¨ (%)',
            title=f"êµ¬ë³„ '{selected_cause}'ì´ ì´ í™”ì¬ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨",
            color='ë¹„ìœ¨ (%)',
            color_continuous_scale=px.colors.sequential.Viridis
        )
        st.plotly_chart(fig_cause_ratio, use_container_width=True)


    st.header("3. êµ¬ë³„ ìƒì„¸ ë°ì´í„° ë° ë¹„ìœ¨")
    st.dataframe(df_cause_sorted.sort_values(by='ì´ í™”ì¬ ê±´ìˆ˜', ascending=False), use_container_width=True)

if __name__ == "__main__":
    app()
